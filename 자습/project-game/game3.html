<!DOCTYPE html>
<html lang="ko">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>달팽이 경주</title>
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link
         href="https://fonts.googleapis.com/css2?family=Poor+Story&display=swap"
         rel="stylesheet"
      />
      <style>
         body {
            background-color: antiquewhite;
         }
         div.wrap {
            margin: 50px auto;
            min-width: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font: normal bold 16px 'Poor Story', sans-serif;
         }
         section.userBoard {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
         }
         section.userBoard > div {
            margin: 20px 0;
         }

         section.setting > span:nth-of-type(3) {
            display: none;
         }

         button {
            padding: 5px;
            border: none;
            border-radius: 5px;
            font: inherit;
            background-color: burlywood;
         }

         .warning {
            display: none;
            color: crimson;
            font-size: 12px;
         }
         section {
            margin: 20px auto;
         }

         input {
            width: 100px;
            outline: none;
            border: none;
            border-bottom: 1px solid black;
            font: inherit;
            background-color: transparent;
         }
         .gameBoard > div {
            margin-top: 20px;
            width: 300px;
            height: 50px;
            line-height: 40px;
            border-bottom: 1px solid black;
         }

         .player {
            transform: translateX(0px);
         }
      </style>
   </head>
   <body>
      <div class="wrap">
         <section class="userBoard">
            <h1>🐌달팽이 경주🐌</h1>
            <h4>게임에 참여할 사람의 이름은?</h4>
            <div class="user1">
               <label for="user1">1번째</label> <input type="text" id="user1" maxlength="10" />
               <p class="warning"></p>
            </div>
            <div class="user2">
               <label for="user2">2번째</label> <input type="text" id="user2" maxlength="10" />
               <p class="warning"></p>
            </div>
         </section>
         <section class="setting">
            <span><button onclick="setUser()">등록 완료!</button></span>
            <span><button onclick="addUser(true)">인원 추가</button></span>
            <span><button onclick="addUser(false)">삭제</button></span>
         </section>
         <section class="gameBoard"></section>
      </div>
      <script>
         const userBoard = document.querySelector('.userBoard')
         const gameBoard = document.querySelector('.gameBoard')
         const [startBtn, addBtn, delBtn] = document.querySelectorAll('.setting > span')

         let userNum = 2

         function addUser(add) {
            if (add) {
               if (userNum >= 10) {
                  addBtn.innerHTML = `<p>최대 인원이 다 찼어요!</p>`
                  return
               } else {
                  userNum++
                  const div = document.createElement('div')
                  div.className = `user${userNum}`
                  div.innerHTML = `
                  <label for="user${userNum}">${userNum}번째</label>
                  <input type="text" id="user${userNum}" maxlength="10"/><p class="warning"></p>`
                  delBtn.style.display = 'inline'
                  userBoard.appendChild(div)
               }
            } else {
               if (userNum > 2) {
                  addBtn.innerHTML = `<button onclick="addUser(true)">인원 추가하기</button>`
                  const userDiv = document.querySelector(`.user${userNum}`)
                  userBoard.removeChild(userDiv)
                  if (userNum === 3) {
                     delBtn.style.display = 'none'
                  }
                  userNum--
               }
            }
            return
         }

         function setUser() {
            const input = document.querySelectorAll('input')
            const p = document.querySelectorAll('.warning')
            const inputList = [...input]
            const pList = [...p]
            const valueList = inputList.map((input) => input.value)
            const userList = valueList.map((value, idx) => {
               if (value) {
                  if (idx === valueList.indexOf(value)) {
                     pList[idx].style.display = 'none'
                     inputList[idx].style.borderBottom = '1px solid black'
                     return value
                  } else {
                     pList[idx].textContent = '중복되지 않는 이름을 사용해주세요.'
                     pList[idx].style.display = 'block'
                     inputList[idx].style.borderBottom = '1px solid crimson'
                     return false
                  }
               } else {
                  pList[idx].style.display = 'block'
                  inputList[idx].style.borderBottom = '1px solid crimson'
                  pList[idx].textContent = '이름을 입력해주세요.'
                  return false
               }
            })
            if (userList.includes(false)) {
               return
            }
            start(userList)
         }

         async function start(userList) {
            userList.forEach((userName, idx) => {
               const div = document.createElement('div')
               div.innerHTML = `
               <div class='player'>${userName}🐌</div>`
               gameBoard.appendChild(div)
            })
            const players = document.querySelectorAll('.player')

            try {
               await run(5, players[0])
            } catch (errer) {
               console.error(errer)
            }
         }

         function run(time, player) {
            return new Promise((resolve) => {
               setTimeout((time) => {
                  player.style.transition = `transform ${time}s`
                  player.style.transform = 'translateX(400px)'
               }, time * 100)
            })
         }
      </script>
   </body>
</html>
